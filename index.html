<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Know Your Zakat Today - జకాత్ లెక్కింపు</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

<style>
body {margin:0; font-family:Arial, sans-serif; background:#f4f4f4;}
.hero {height:32vh; background:linear-gradient(135deg,#0f2027,#203a43,#2c5364); display:flex; align-items:center; justify-content:center; text-align:center;}
.ayah {color:#d4af37; font-family:'Amiri',serif; font-size:26px;}
.container {max-width:900px; margin:-40px auto 40px; background:white; padding:20px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.1);}
h2 {text-align:center; margin-top:0;}
label {font-weight:bold; display:block; margin-top:8px;}
input, select {width:100%; padding:8px; margin:4px 0 8px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box;}
.section-title {margin:25px 0 10px; font-size:18px; font-weight:bold; background:#f8f9fa; padding:8px; border-radius:6px;}
.guide {font-size:0.85em; color:#555; margin:4px 0 12px;}
.result-box {background:#f0f0f0; padding:12px; border-radius:6px; margin-top:10px; white-space:pre-line; font-weight:bold; line-height:1.5;}
.summary {margin-top:20px; padding:15px; background:#e8f1f7; border-radius:8px; font-weight:bold;}
.nisab-box {margin-top:15px; padding:15px; background:#fff3cd; color:#856404; border-radius:8px; font-weight:bold;}
.button {width:100%; padding:12px; background:#d4af37; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin:10px 0; font-size:16px;}
.small {text-align:center; font-size:12px; color:#777; margin:10px 0;}
.footer {text-align:center; margin:20px 0; font-size:12px; color:#777;}
hr {margin:25px 0; border-color:#eee;}
@media (max-width:600px) {.container {padding:15px;}}
</style>
</head>
<body>

<div class="hero">
  <div class="ayah">وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ</div>
</div>

<div class="container">

  <h2>Know Your Zakat Today (జకాత్ లెక్కింపు)</h2>
  <div id="hijriDate" class="small"></div>

  <p class="guide"><strong>మార్గదర్శకం / Guidance:</strong> Enter values as on your Zakat due date. Prices auto-update from rates.json (update daily via GitHub repo).</p>

  <label>Optional Name (పేరు)</label>
  <input type="text" id="userName" placeholder="Your name (optional for PDF)">

  <div class="section-title">PERSONAL ASSETS (వ్యక్తిగత ఆస్తులు)</div>
  <p class="guide">Include gold, silver, cash, bank, receivables, investments etc. that are zakatable.</p>

  <label>Gold (grams) - బంగారం (గ్రాములు)</label>
  <input type="number" id="goldGrams" min="0" step="any" placeholder="Total gold weight in grams (for selected purity)">

  <label>Gold Purity - బంగారం స్వచ్ఛత</label>
  <select id="goldPurity">
    <option value="1" data-karat="24k">24K / Pure</option>
    <option value="0.916" data-karat="22k" selected>22K (common jewellery)</option>
    <option value="0.75" data-karat="18k">18K</option>
  </select>
  <div class="guide">Changing purity auto-updates the price below to match the karat rate from rates.json.</div>

  <label>Gold Price (per gram for selected purity) - బంగారం ధర (ఎంచుకున్న స్వచ్ఛతకు గ్రాముకు)</label>
  <input type="number" id="goldPrice" value="15700" step="10" placeholder="Auto-updates based on purity" readonly style="background:#f9f9f9;">

  <label>Silver (grams) - వెండి (గ్రాములు)</label>
  <input type="number" id="silverGrams" min="0" step="any" placeholder="Total silver weight in grams">

  <label>Silver Price (per gram) - వెండి ధర (గ్రాముకు)</label>
  <input type="number" id="silverPrice" value="270" step="1" placeholder="From rates.json" readonly style="background:#f9f9f9;">

  <label>Cash in Hand - నగదు (ఇంట్లో / దగ్గర)</label>
  <input type="number" id="personalCash" min="0" step="any" placeholder="Physical cash you currently have">

  <label>Bank Balance / Savings - బ్యాంకు బ్యాలెన్స్</label>
  <input type="number" id="personalBank" min="0" step="any" placeholder="All bank accounts total">

  <label>Receivables (debts owed to you) - ఇతరులు చెల్లించాల్సిన డబ్బు</label>
  <input type="number" id="personalReceivables" min="0" step="any" placeholder="Loans given, pending salary, etc. (if recoverable)">

  <label>Investments / Shares / Mutual Funds - పెట్టుబడులు / షేర్లు</label>
  <input type="number" id="personalInvestments" min="0" step="any" placeholder="Current market value">

  <label>Crypto / Digital Assets - క్రిప్టో / డిజిటల్</label>
  <input type="number" id="personalCrypto" min="0" step="any" placeholder="Current value (if zakatable per your madhab)">

  <label>Other Liquid Wealth - ఇతర ద్రవ ఆస్తులు</label>
  <input type="number" id="personalOther" min="0" step="any" placeholder="Any other cash-like or easily sellable assets">

  <label>Total Personal Current Liabilities - ప్రస్తుత వ్యక్తిగత రుణాలు</label>
  <input type="number" id="personalLiabilities" min="0" step="any" placeholder="Debts due soon (long-term loans usually excluded)">

  <div class="result-box" id="personalResult"></div>

  <hr>

  <div class="section-title">BUSINESS ASSETS (వ్యాపార ఆస్తులు)</div>
  <p class="guide">Use current sale/market value (not cost price). Deduct only current payables.</p>

  <label>Closing Stock (at sale value) - ముగింపు స్టాక్ (అమ్మకం విలువ)</label>
  <input type="number" id="stock" min="0" step="any" placeholder="Market value of unsold goods">

  <label>Raw Materials - ముడి సరుకు విలువ</label>
  <input type="number" id="raw" min="0" step="any" placeholder="Current value of raw stock">

  <label>Finished Goods - పూర్తి చేసిన వస్తువుల విలువ</label>
  <input type="number" id="finished" min="0" step="any" placeholder="Sale value of ready products">

  <label>Business Cash - వ్యాపార నగదు</label>
  <input type="number" id="bizCash" min="0" step="any" placeholder="Cash in shop/business">

  <label>Business Bank Balance - వ్యాపార బ్యాంకు</label>
  <input type="number" id="bizBank" min="0" step="any" placeholder="Business account balance">

  <label>Customer Receivables - కస్టమర్ల నుండి వసూలు చేయాల్సినవి</label>
  <input type="number" id="bizReceivables" min="0" step="any" placeholder="Amounts owed by customers">

  <label>Business Current Liabilities - ప్రస్తుత వ్యాపార బాధ్యతలు</label>
  <input type="number" id="bizLiabilities" min="0" step="any" placeholder="Bills, suppliers due now">

  <div class="result-box" id="businessResult"></div>

  <div class="summary" id="finalSummary"></div>

  <div class="nisab-box" id="nisabInfo"></div>

  <button class="button" onclick="downloadPDF()">Download Professional PDF Report</button>

  <hr>

  <h3 style="text-align:center;">Support Madarsa</h3>
  <p style="text-align:center;">UPI: muftiasifali94@okhdfcbank</p>
  <img src="donation-qr.png" style="width:220px; display:block; margin:15px auto;" alt="Donation QR">

  <a href="upi://pay?pa=muftiasifali94@okhdfcbank&pn=Zakat&cu=INR" style="text-decoration:none;">
    <button class="button">Pay via UPI</button>
  </a>

  <div class="footer">Powered by ن Enterprises | Prices from rates.json (last updated in repo)</div>

</div>

<script>
let rates = {
  gold_24k: 15700,
  gold_22k: 14375,
  gold_18k: 11775,
  silver: 270
}; // Fallback

function formatINR(num) {
  return num.toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
}

function showHijri() {
  const today = new Date();
  const jd = Math.floor((today / 86400000) + 2440587.5);
  const l = jd - 1948440 + 10632;
  const n = Math.floor((l - 1) / 10631);
  let ll = l - 10631 * n + 354;
  const j = (Math.floor((10985 - ll) / 5316)) * (Math.floor((50 * ll) / 17719))
          + (Math.floor(ll / 5670)) * (Math.floor((43 * ll) / 15238));
  ll = ll - (Math.floor((30 - j) / 15)) * (Math.floor((17719 * j) / 50))
         - (Math.floor(j / 16)) * (Math.floor((15238 * j) / 43)) + 29;
  const month = Math.floor((24 * ll) / 709);
  const day = ll - Math.floor((709 * month) / 24);
  const year = 30 * n + j - 30;
  const months = ["Muharram","Safar","Rabi al-Awwal","Rabi al-Thani",
                  "Jumada al-Awwal","Jumada al-Thani","Rajab","Sha'ban","Ramadan",
                  "Shawwal","Dhul-Qadah","Dhul-Hijjah"];
  document.getElementById("hijriDate").innerText = 
    "Hijri Date (Global): " + day + " " + months[month - 1] + " " + year + " AH";
}
showHijri();

function updateGoldPrice() {
  const puritySelect = document.getElementById('goldPurity');
  const selectedKarat = puritySelect.options[puritySelect.selectedIndex].dataset.karat;
  const priceKey = `gold_${selectedKarat}`;
  document.getElementById('goldPrice').value = rates[priceKey] || rates.gold || 15700; // fallback to old 'gold' key if exists
  calculate();
}

function calculate() {
  const goldVal = (+goldGrams.value || 0) * (+goldPrice.value || 0);
  const silverVal = (+silverGrams.value || 0) * (+silverPrice.value || 0);

  const personalAssets = goldVal + silverVal +
    (+personalCash.value || 0) + (+personalBank.value || 0) +
    (+personalReceivables.value || 0) + (+personalInvestments.value || 0) +
    (+personalCrypto.value || 0) + (+personalOther.value || 0);

  const personalLiab = (+personalLiabilities.value || 0);
  const personalNet = personalAssets - personalLiab;
  const personalZakat = personalNet > 0 ? personalNet / 40 : 0;

  document.getElementById("personalResult").innerText =
    `Total Personal Assets: ₹${formatINR(personalAssets)}\n` +
    `Personal Liabilities: ₹${formatINR(personalLiab)}\n` +
    `Personal Net: ₹${formatINR(personalNet)}\n` +
    `Zakat (2.5%): ₹${formatINR(personalZakat)}`;

  const bizAssets = (+stock.value || 0) + (+raw.value || 0) + (+finished.value || 0) +
    (+bizCash.value || 0) + (+bizBank.value || 0) + (+bizReceivables.value || 0);

  const bizLiab = (+bizLiabilities.value || 0);
  const bizNet = bizAssets - bizLiab;
  const bizZakat = bizNet > 0 ? bizNet / 40 : 0;

  document.getElementById("businessResult").innerText =
    `Total Business Assets: ₹${formatINR(bizAssets)}\n` +
    `Business Liabilities: ₹${formatINR(bizLiab)}\n` +
    `Business Net: ₹${formatINR(bizNet)}\n` +
    `Zakat (2.5%): ₹${formatINR(bizZakat)}`;

  const totalZakat = personalZakat + bizZakat;
  document.getElementById("finalSummary").innerText = `TOTAL ZAKAT PAYABLE: ₹${formatINR(totalZakat)}`;

  const nisabSilver = 612.36 * (+silverPrice.value || 270);
  const nisabGold   = 87.48  * (+goldPrice.value   || 15700);

  document.getElementById("nisabInfo").innerHTML =
    `Nisab (silver basis): ≈ ₹${formatINR(nisabSilver)} (612.36 g)<br>` +
    `Nisab (gold basis):   ≈ ₹${formatINR(nisabGold)} (87.48 g)<br>` +
    `<strong>Your total net wealth: ₹${formatINR(personalNet + bizNet)}</strong><br>` +
    ((personalNet + bizNet) >= Math.min(nisabSilver, nisabGold) ?
      "✅ You meet/exceed Nisab → Zakat is due (if held for 1 Hijri year)" :
      "❌ Below Nisab → No Zakat due currently");
}

document.querySelectorAll("input, select").forEach(el => {
  if (el.id !== 'goldPurity') el.addEventListener("input", calculate);
});

document.getElementById('goldPurity').addEventListener('change', updateGoldPrice);

async function loadRates() {
  try {
    const response = await fetch('rates.json');
    if (response.ok) {
      rates = await response.json();
      document.getElementById('silverPrice').value = rates.silver || 270;
      updateGoldPrice(); // Apply to current purity
    }
  } catch (error) {
    console.error('Failed to load rates.json:', error);
  }
  calculate();
}

function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 20;

  doc.setFontSize(18);
  doc.setTextColor(212, 175, 55);
  doc.text("Zakat Calculation Report", 105, y, { align: "center" });
  y += 12;

  doc.setFontSize(11);
  doc.setTextColor(0);
  doc.text("Name: " + (userName.value.trim() || "N/A"), 20, y);
  doc.text("Date: " + new Date().toLocaleDateString('en-IN'), 140, y);
  y += 8;
  doc.text(document.getElementById("hijriDate").innerText, 20, y);
  y += 12;

  doc.setFontSize(14);
  doc.setTextColor(220, 53, 69);
  doc.text(document.getElementById("finalSummary").innerText, 105, y, { align: "center" });
  y += 15;

  doc.setFontSize(12);
  doc.text("Personal Section (వ్యక్తిగత)", 20, y);
  y += 8;

  doc.autoTable({
    startY: y,
    head: [['Description', 'Amount (₹)']],
    body: [
      ['Gold (' + document.getElementById('goldPurity').options[document.getElementById('goldPurity').selectedIndex].text + ')', formatINR((+goldGrams.value||0)*(+goldPrice.value||0))],
      ['Silver', formatINR((+silverGrams.value||0)*(+silverPrice.value||0))],
      ['Cash in hand', formatINR(+personalCash.value||0)],
      ['Bank balance', formatINR(+personalBank.value||0)],
      ['Receivables', formatINR(+personalReceivables.value||0)],
      ['Investments / Shares', formatINR(+personalInvestments.value||0)],
      ['Crypto / Digital', formatINR(+personalCrypto.value||0)],
      ['Other liquid wealth', formatINR(+personalOther.value||0)],
      ['Total Personal Assets', formatINR( (+goldGrams.value||0)*(+goldPrice.value||0) + (+silverGrams.value||0)*(+silverPrice.value||0) + (+personalCash.value||0) + (+personalBank.value||0) + (+personalReceivables.value||0) + (+personalInvestments.value||0) + (+personalCrypto.value||0) + (+personalOther.value||0) )],
      ['Personal Liabilities', formatINR(+personalLiabilities.value||0)],
      ['Personal Net', formatINR( (+goldGrams.value||0)*(+goldPrice.value||0) + (+silverGrams.value||0)*(+silverPrice.value||0) + (+personalCash.value||0) + (+personalBank.value||0) + (+personalReceivables.value||0) + (+personalInvestments.value||0) + (+personalCrypto.value||0) + (+personalOther.value||0) - (+personalLiabilities.value||0) )],
      ['Zakat 2.5%', formatINR( Math.max(0, ((+goldGrams.value||0)*(+goldPrice.value||0) + (+silverGrams.value||0)*(+silverPrice.value||0) + (+personalCash.value||0) + (+personalBank.value||0) + (+personalReceivables.value||0) + (+personalInvestments.value||0) + (+personalCrypto.value||0) + (+personalOther.value||0) - (+personalLiabilities.value||0)) / 40 ) )]
    ],
    margin: { left: 20, right: 20 },
    theme: 'grid',
    styles: { fontSize: 9, cellPadding: 3 },
    headStyles: { fillColor: [212, 175, 55], textColor: [0,0,0] }
  });
  y = doc.lastAutoTable.finalY + 12;

  // Business table (same as before)
  doc.setFontSize(12);
  doc.text("Business Section (వ్యాపారం)", 20, y);
  y += 8;

  doc.autoTable({
    startY: y,
    head: [['Description', 'Amount (₹)']],
    body: [
      ['Closing Stock', formatINR(+stock.value||0)],
      ['Raw Materials', formatINR(+raw.value||0)],
      ['Finished Goods', formatINR(+finished.value||0)],
      ['Business Cash', formatINR(+bizCash.value||0)],
      ['Business Bank', formatINR(+bizBank.value||0)],
      ['Customer Receivables', formatINR(+bizReceivables.value||0)],
      ['Total Business Assets', formatINR( (+stock.value||0) + (+raw.value||0) + (+finished.value||0) + (+bizCash.value||0) + (+bizBank.value||0) + (+bizReceivables.value||0) )],
      ['Business Liabilities', formatINR(+bizLiabilities.value||0)],
      ['Business Net', formatINR( (+stock.value||0) + (+raw.value||0) + (+finished.value||0) + (+bizCash.value||0) + (+bizBank.value||0) + (+bizReceivables.value||0) - (+bizLiabilities.value||0) )],
      ['Zakat 2.5%', formatINR( Math.max(0, ((+stock.value||0) + (+raw.value||0) + (+finished.value||0) + (+bizCash.value||0) + (+bizBank.value||0) + (+bizReceivables.value||0) - (+bizLiabilities.value||0)) / 40 ) )]
    ],
    margin: { left: 20, right: 20 },
    theme: 'grid',
    styles: { fontSize: 9, cellPadding: 3 },
    headStyles: { fillColor: [212, 175, 55], textColor: [0,0,0] }
  });
  y = doc.lastAutoTable.finalY + 12;

  doc.setFontSize(10);
  doc.setTextColor(80);
  doc.text("Nisab & Notes:", 20, y); y += 7;
  let nisabLines = document.getElementById("nisabInfo").innerText.split('\n');
  nisabLines.forEach(line => { doc.text(line.trim(), 25, y); y += 6; });
  y += 5;

  doc.text("- Zakat @ 2.5% on net zakatable wealth", 20, y); y += 6;
  doc.text("- Prices from rates.json (updated: " + (rates.lastUpdated || 'unknown') + ")", 20, y); y += 6;
  doc.text("- Consult scholar for rulings", 20, y);

  doc.save(`Zakat_Report_\( {userName.value.trim() || 'User'}_ \){new Date().toISOString().slice(0,10)}.pdf`);
}

window.onload = () => {
  loadRates();
};
</script>

</body>
</html>
